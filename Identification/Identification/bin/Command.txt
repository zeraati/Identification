SELECT [a].[Name] a_Name,[b].[Name] b_Name,[a].[Family] a_Family,[b].[Family] b_Family,[a].[Father] a_Father,[b].[Father] b_Father,[a].[CodeMelli] a_CodeMelli,[b].[CodeMelli] b_CodeMelli,[a].[ShenasCode] a_ShenasCode,[b].[ShenasCode] b_ShenasCode,[a].[Mobile] a_Mobile,[b].[Mobile] b_Mobile FROM [Ehraz].dbo.[TBL_Student_95-02-21_copy] a JOIN [Ehraz].dbo.[TBL_MKsarparast_95-02-21_copy] b ON Replace(a.[STID], ' ', '') = Replace(b.[STID], ' ', '')Where (dbo.GetPercentageOfTwoStringMatching(REPLACE(a.[Name],' ',''),REPLACE(b.[Name],' ',''))>=80 AND dbo.GetPercentageOfTwoStringMatching(REPLACE(a.[Name],' ',''),REPLACE(b.[Name],' ',''))<85) OR (a.[Family] IS NULL OR b.[Family] IS NULL ) OR (Replace(a.[Family] ,'سيد','') = Replace(b.[Family],'سيد','') AND (a.[Family] LIKE N'%سيد%' OR b.[Family] LIKE N'%سيد%') AND a.[Family]<>b.[Family]) OR (Replace(a.[Family] ,'مير','') = Replace(b.[Family],'مير','') AND (a.[Family] LIKE N'%مير%' OR b.[Family] LIKE N'%مير%') AND a.[Family]<>b.[Family]) OR (REPLACE(REPLACE(a.[Family], N'الله', ''), N'اله', '') = REPLACE(REPLACE(b.[Family], N'الله', ''), N'اله', '') AND (a.[Family] LIKE N'%اله%' OR b.[Family] LIKE N'%اله%' or a.[Family] LIKE N'%الله%' or b.[Family] LIKE N'%الله%') AND a.[Family]<> b.[Family]) OR (a.[Father] IS NULL OR b.[Father] IS NULL ) OR (Replace(a.[Father] ,'سيد','') = Replace(b.[Father],'سيد','') AND (a.[Father] LIKE N'%سيد%' OR b.[Father] LIKE N'%سيد%') AND a.[Father]<>b.[Father]) OR (Replace(a.[Father] ,'مير','') = Replace(b.[Father],'مير','') AND (a.[Father] LIKE N'%مير%' OR b.[Father] LIKE N'%مير%') AND a.[Father]<>b.[Father]) OR (REPLACE(REPLACE(a.[Father], N'الله', ''), N'اله', '') = REPLACE(REPLACE(b.[Father], N'الله', ''), N'اله', '') AND (a.[Father] LIKE N'%اله%' OR b.[Father] LIKE N'%اله%' or a.[Father] LIKE N'%الله%' or b.[Father] LIKE N'%الله%') AND a.[Father]<> b.[Father]) AND b.ShenasCode=a.ShenasCode AND b.ShenasCode is not null AND a.CodeMelli=b.CodeMelli AND b.CodeMelli is not null  AND b.[STID_vld] IS NULL 